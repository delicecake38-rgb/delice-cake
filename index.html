<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>D√©lices Cake - Boutique de Tiramisu</title>

```
<!-- Supabase v2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
    /* Styles g√©n√©raux */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #f9f5f0; color: #5c3d2e; line-height: 1.6; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    section { padding: 60px 0; }
    h1,h2,h3 { color: #8b5a2b; margin-bottom: 20px; }

    /* Header */
    header { background-color: #8b5a2b; padding: 15px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .nav-container { display:flex; justify-content:space-between; align-items:center; max-width:1200px; margin:0 auto; padding:0 20px; }
    .logo-header { color:white; font-size:24px; font-weight:bold; }
    .nav-links { display:flex; gap:30px; }
    .nav-links a { color:white; text-decoration:none; transition:opacity .3s; }
    .nav-links a:hover { opacity:.8; }

    /* Partie 1 */
    #partie1 { background-color:#f1e6d2; text-align:center; padding:40px 0; }
    .logo { max-width:200px; margin-bottom:20px; }

    .video-container { max-width:800px; margin:0 auto; border-radius:10px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
    .video-placeholder { background-color:#8b5a2b; color:white; padding:100px 20px; font-size:18px; }

    /* Partie 2 - Produits */
    #partie2 { background-color:white; }
    .produits-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:30px; }
    .produit { background-color:#f9f5f0; border-radius:10px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.05); transition:transform .3s ease; display:flex; flex-direction:column; }
    .produit:hover { transform:translateY(-5px); }

    .produit-media { width:100%; height:200px; background:#e6d7c3; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .produit-media img { width:100%; height:100%; object-fit:cover; display:block; }

    .produit-info { padding:20px; flex:1; display:flex; flex-direction:column; }
    .produit-nom { font-size:20px; margin-bottom:10px; color:#5c3d2e; }
    .produit-prix { font-size:18px; font-weight:bold; color:#8b5a2b; margin-bottom:10px; }
    .produit-description { margin-bottom:15px; font-size:14px; color:#666; flex:1; }
    .ingredients { font-size:13px; color:#7d5d3f; margin-top:10px; font-style:italic; }

    .btn-ajouter { background-color:#8b5a2b; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer; width:100%; font-size:16px; transition:background-color .3s; margin-top:10px; }
    .btn-ajouter:hover { background-color:#6d4621; }
    .btn-ajouter.success { background-color:#4CAF50; }

    /* Partie 3 */
    #partie3 { background-color:#f1e6d2; }
    .remarques { display:flex; flex-wrap:wrap; justify-content:space-between; }
    .remarque { flex:0 0 48%; background:white; padding:25px; border-radius:10px; margin-bottom:20px; box-shadow:0 3px 10px rgba(0,0,0,0.05); }
    .remarque h3 { display:flex; align-items:center; margin-bottom:15px; }
    .remarque h3 i { margin-right:10px; color:#8b5a2b; }

    /* Partie 4 - Contact */
    #partie4 { background-color:white; }
    .contact-container { display:flex; flex-wrap:wrap; justify-content:space-between; }
    .coordonnees { flex:0 0 45%; margin-bottom:30px; }
    .coordonnee-item { margin-bottom:15px; display:flex; align-items:flex-start; }
    .coordonnee-item i { margin-right:10px; color:#8b5a2b; margin-top:5px; }
    .formulaire-contact { flex:0 0 45%; }

    .form-group { margin-bottom:20px; }
    .form-group label { display:block; margin-bottom:5px; font-weight:500; }
    .form-control { width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; font-size:16px; }
    textarea.form-control { min-height:120px; resize:vertical; }

    .btn-envoyer { background-color:#8b5a2b; color:white; border:none; padding:12px 25px; border-radius:5px; cursor:pointer; font-size:16px; transition:background-color .3s; }
    .btn-envoyer:hover { background-color:#6d4621; }

    footer { background-color:#5c3d2e; color:white; text-align:center; padding:20px 0; margin-top:40px; }

    /* Responsive */
    @media (max-width:768px) {
        .remarque { flex:0 0 100%; }
        .coordonnees, .formulaire-contact { flex:0 0 100%; }
    }

    .loading { text-align:center; padding:20px; color:#8b5a2b; }
    .error { text-align:center; padding:20px; color:#d32f2f; background-color:#ffebee; border-radius:5px; margin:10px 0; }
</style>
```

</head>
<body>
    <header>
        <div class="nav-container">
            <div class="logo-header">D√©lices Cake</div>
            <nav class="nav-links">
                <a href="index.html">Accueil</a>
                <a href="panier.html">Panier (<span id="nb-articles">0</span>)</a>
            </nav>
        </div>
    </header>

```
<section id="partie1">
    <div class="container">
        <div class="logo-container">
            <div class="logo">[VOTRE LOGO ICI]</div>
            <h1>D√©lices Cake</h1>
        </div>
        <div class="video-container">
            <div class="video-placeholder">[VID√âO PUBLICITAIRE √Ä INT√âGRER]</div>
        </div>
    </div>
</section>

<section id="partie2">
    <div class="container">
        <h2>Nos D√©licieux Tiramisus</h2>
        <div id="produits-grid" class="produits-grid">
            <div class="loading">Chargement des produits...</div>
        </div>
    </div>
</section>

<section id="partie3">
    <div class="container">
        <h2>Informations Importantes</h2>
        <div class="remarques">
            <div class="remarque">
                <h3>üìû Commandes en Gros</h3>
                <p>Pour toute commande importante (plus de 20 pi√®ces), veuillez nous contacter directement pour discuter de vos besoins et obtenir un tarif pr√©f√©rentiel.</p>
            </div>
            <div class="remarque">
                <h3>üöö Livraison Gratuite</h3>
                <p>Nous offrons la livraison gratuite √† partir de 8 pi√®ces command√©es dans un rayon de 15km autour de notre boutique.</p>
            </div>
            <div class="remarque">
                <h3>üéÅ Box Surprise Offerte</h3>
                <p>Pour toute commande de 10 pi√®ces ou plus, recevez gratuitement notre box surprise contenant deux de nos cr√©ations sp√©ciales.</p>
            </div>
            <div class="remarque">
                <h3>‚è±Ô∏è Pr√©paration Fra√Æche</h3>
                <p>Tous nos tiramisus sont pr√©par√©s le jour m√™me de la livraison/retrait pour garantir une fra√Æcheur et un go√ªt optimaux.</p>
            </div>
        </div>
    </div>
</section>

<section id="partie4">
    <div class="container">
        <h2>Contactez-nous</h2>
        <div class="contact-container">
            <div class="coordonnees">
                <h3>Nos Coordonn√©es</h3>

                <div class="coordonnee-item">
                    <i>üìû</i>
                    <div>
                        <strong>T√©l√©phone:</strong><br>
                        <span id="telephone">Chargement...</span>
                    </div>
                </div>

                <div class="coordonnee-item">
                    <i>‚úâÔ∏è</i>
                    <div>
                        <strong>Email:</strong><br>
                        <span id="email">Chargement...</span>
                    </div>
                </div>

                <div class="coordonnee-item">
                    <i>üìç</i>
                    <div>
                        <strong>Adresse:</strong><br>
                        <span id="adresse">Chargement...</span>
                    </div>
                </div>

                <div class="coordonnee-item">
                    <i>üïí</i>
                    <div>
                        <strong>Horaires d'ouverture:</strong><br>
                        <span id="horaires">Chargement...</span>
                    </div>
                </div>
            </div>

            <div class="formulaire-contact">
                <h3>Formulaire de Contact</h3>
                <form id="contact-form">
                    <div class="form-group">
                        <label for="nom">Nom et Pr√©nom</label>
                        <input type="text" id="nom" class="form-control" required />
                    </div>

                    <div class="form-group">
                        <label for="email-client">Email</label>
                        <input type="email" id="email-client" class="form-control" required />
                    </div>

                    <div class="form-group">
                        <label for="sujet">Sujet</label>
                        <input type="text" id="sujet" class="form-control" required />
                    </div>

                    <div class="form-group">
                        <label for="message">Message</label>
                        <textarea id="message" class="form-control" required></textarea>
                    </div>

                    <button type="submit" class="btn-envoyer">Envoyer le message</button>
                </form>
            </div>
        </div>
    </div>
</section>

<footer>
    <div class="container">
        <p>&copy; 2025 D√©lices Cake - Tous droits r√©serv√©s</p>
    </div>
</footer>

<script>
    // ---- CONFIG SUPABASE ----
    const supabaseUrl = 'https://ypxvnxddzgaopjdhclzj.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlweHZueGRkemdhb3BqZGhjbHpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzODk1OTUsImV4cCI6MjA3Nzk2NTU5NX0.bMhlMjgbxjCZRUbXn0-WoZZaeSOySSAoEPzmL9UwpCo';

    // Initialisation correcte (Supabase v2)
    const { createClient } = supabase;
    const client = createClient(supabaseUrl, supabaseKey);
    console.log('‚úÖ Supabase (client) initialis√©');

    // ---- CHARGER PRODUITS ----
    async function chargerProduits() {
        const grid = document.getElementById('produits-grid');
        grid.innerHTML = '<div class="loading">Chargement des produits...</div>';

        try {
            const { data: produits, error } = await client
                .from('produits')
                .select('*')
                .order('id', { ascending: true });

            if (error) {
                console.error('‚ùå Erreur Supabase produits:', error);
                grid.innerHTML = '<div class="error">Erreur de chargement des produits: ' + (error.message || error) + '</div>';
                return;
            }

            if (!produits || produits.length === 0) {
                grid.innerHTML = '<div class="error">Aucun produit trouv√© dans la base de donn√©es.</div>';
                return;
            }

            afficherProduits(produits);
        } catch (err) {
            console.error('‚ùå Exception lors du chargement produits:', err);
            grid.innerHTML = '<div class="error">Erreur technique lors du chargement des produits.</div>';
        }
    }

    // ---- AFFICHER PRODUITS ----
    function afficherProduits(produits) {
        const container = document.getElementById('produits-grid');
        container.innerHTML = ''; // vider avant affichage

        produits.forEach(produit => {
            // S√©curiser les valeurs
            const nom = produit.nom || 'Produit';
            const prix = produit.prix != null ? parseFloat(produit.prix).toFixed(2) + ' ‚Ç¨' : '‚Äî';
            const description = produit.description || '';
            const gout = produit.gout || '';
            const ingredients = produit.ingredients || '';
            const imageUrl = produit.image_url || '';

            const card = document.createElement('div');
            card.className = 'produit';

            card.innerHTML = `
                <div class="produit-media">
                    <img src="${imageUrl}" alt="${escapeHtml(nom)}" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'600\\' height=\\'400\\'><rect width=\\'100%\\' height=\\'100%\\' fill=\\'%23e6d7c3\\'/><text x=\\'50%\\' y=\\'50%\\' dominant-baseline=\\'middle\\' text-anchor=\\'middle\\' font-size=\\'24\\' fill=\\'%238b5a2b\\'>üç∞</text></svg>' />
                </div>
                <div class="produit-info">
                    <div>
                        <h3 class="produit-nom">${escapeHtml(nom)}</h3>
                        <div class="produit-prix">${prix}</div>
                    </div>

                    <div class="produit-description">
                        <p>${escapeHtml(description)}</p>
                        ${gout ? `<p><strong>Go√ªt :</strong> ${escapeHtml(gout)}</p>` : ''}
                        ${ingredients ? `<div class="ingredients"><strong>Ingr√©dients :</strong> ${escapeHtml(ingredients)}</div>` : ''}
                    </div>

                    <button class="btn-ajouter"
                        data-nom="${escapeAttr(nom)}"
                        data-prix="${escapeAttr(produit.prix)}"
                        data-id="${escapeAttr(produit.id)}">
                        Ajouter au panier
                    </button>
                </div>
            `;

            container.appendChild(card);
        });
    }

    // ---- CHARGER COORDONN√âES ----
    async function chargerCoordonnees() {
        const telephoneEl = document.getElementById('telephone');
        const emailEl = document.getElementById('email');
        const adresseEl = document.getElementById('adresse');
        const horairesEl = document.getElementById('horaires');

        try {
            const { data: coordonnees, error } = await client
                .from('coordonnees')
                .select('*')
                .limit(1);

            if (error) {
                console.error('‚ùå Erreur Supabase coordonn√©es:', error);
                // valeurs fallback
                appliquerCoordonneesFallback();
                return;
            }

            if (coordonnees && coordonnees.length > 0) {
                const c = coordonnees[0];
                if (c.telephone) telephoneEl.textContent = c.telephone;
                if (c.email) emailEl.textContent = c.email;
                if (c.adresse) adresseEl.textContent = c.adresse;
                if (c.horaires) horairesEl.innerHTML = c.horaires.replace(/\n/g, '<br>');
            } else {
                appliquerCoordonneesFallback();
            }
        } catch (err) {
            console.error('‚ùå Exception coordonn√©es:', err);
            appliquerCoordonneesFallback();
        }

        function appliquerCoordonneesFallback() {
            telephoneEl.textContent = "07 84 96 45 71";
            emailEl.textContent = "delicecake38@gmail.com";
            adresseEl.textContent = "Grenoble";
            horairesEl.textContent = "Lundi - Dimanche: 10h-19h";
        }
    }

    // ---- PANIER ----
    function ajouterAuPanier(nom, prix, id, button) {
        let panier = JSON.parse(localStorage.getItem('panier')) || [];

        // Utiliser id comme cl√© (string)
        const articleExistant = panier.find(article => String(article.id) === String(id));

        if (articleExistant) {
            articleExistant.quantite += 1;
        } else {
            panier.push({
                id: id,
                nom: nom,
                prix: parseFloat(prix) || 0,
                quantite: 1
            });
        }

        localStorage.setItem('panier', JSON.stringify(panier));
        mettreAJourCompteurPanier();

        // Animation
        if (button) {
            const originalText = button.textContent;
            button.textContent = '‚úì Ajout√© !';
            button.classList.add('success');

            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('success');
            }, 1600);
        }
    }

    function mettreAJourCompteurPanier() {
        const panier = JSON.parse(localStorage.getItem('panier')) || [];
        const totalArticles = panier.reduce((total, article) => total + (article.quantite || 0), 0);
        const compteurElement = document.getElementById('nb-articles');
        if (compteurElement) compteurElement.textContent = totalArticles;
    }

    // ---- GESTION √âV√âNEMENTS ----
    document.addEventListener('click', function(e) {
        const target = e.target;
        if (target && target.classList.contains('btn-ajouter')) {
            const nom = target.getAttribute('data-nom');
            const prix = target.getAttribute('data-prix');
            const id = target.getAttribute('data-id');
            ajouterAuPanier(nom, prix, id, target);
        }
    });

    document.getElementById('contact-form').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Merci pour votre message ! Nous vous r√©pondrons dans les plus brefs d√©lais.');
        this.reset();
    });

    // ---- UTILITAIRES (s√©curit√© affichage) ----
    function escapeHtml(str) {
        if (str === null || str === undefined) return '';
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
    }
    function escapeAttr(str) {
        if (str === null || str === undefined) return '';
        return String(str).replace(/"/g, '&quot;').replace(/'/g, '&#039;');
    }

    // ---- D√âMARRAGE ----
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('üöÄ Page charg√©e ‚Äî init Supabase & chargement donn√©es');
        await chargerProduits();
        await chargerCoordonnees();
        mettreAJourCompteurPanier();

        // debug console helper
        window.debugSupabase = async function() {
            console.log('=== DEBUG SUPABASE (client) ===');
            const { data: produits, error: errProd } = await client.from('produits').select('*');
            console.log('Produits:', produits, 'ErrProd:', errProd);
            const { data: coord, error: errCoord } = await client.from('coordonnees').select('*');
            console.log('Coordonn√©es:', coord, 'ErrCoord:', errCoord);
            console.log('=== FIN DEBUG ===');
        };
    });
</script>
```

</body>
</html>

